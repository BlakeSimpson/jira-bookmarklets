javascript:void(function(){var xing=xing||{};xing.jira=xing.jira||{},xing.jira.Application=function(a){"use strict";var b,c,d,e,f=this;f.initialze=function(a){b=new xing.jira.DataCollector,d=new xing.jira.TableBuilder,e=new xing.jira.TableData,c=(new xing.jira.I18n).local(),f.addStyle(a),f.collectDataFromDom(b)},f._getContainer=function(a){return a.hasClass("gm-container")&&a||a.parents(".gm-container")},f._clickOutsidePopupHandler=function(a){var b=$(a.target),c=f._getContainer(b);c[0]||f._hidePopup()},f._hidePopup=function(){$("#gm-popup").remove(),$(document).off("click",f._clickOutsidePopupHandler)},f._updateHTML=function(a){$("#gm-popup").remove();var f=e.get(b.ticketData),g=d.render(f),h="",i=a.length+1,j=Math.ceil(i/2);a.forEach(function(a){var b=$(a).find(".gm-number").text(),d=$(g).find(".gm-number").text(),e="aui-button gm-button-danger js-gm-remove-ticket";b!==d&&(h+='<li class="gm-output-item">'+a+'<div class="gm-ticket-action-panel"><button type="button" class="'+e+'">'+c.modal.action.remove+"</button></div></li>")}),$("body").append($('<div id="gm-popup"><div class="gm-container jira-dialog box-shadow "><div class="jira-dialog-heading"><h2>'+c.modal.heading+'</h2></div><div class="jira-dialog-content"><div class="gm-page-counter">'+c.modal.ticketCount+" "+i+c.modal.pageCount+" "+j+'</div><div class="form-body"><ul class="gm-output-list">'+h+'<li class="gm-output-item">'+g+'</li></ul></div><div class="buttons-container form-footer"><div class="buttons"><label for="gm-select-ticket">'+c.modal.select+'</label>&nbsp;<button id="gm-select-ticket" class="gm-pick-more aui-button"><i>+</i></button>&nbsp;<button class="gm-print aui-button">'+c.modal.action.print+'</button><a class="gm-cancel cancel" href="#">'+c.modal.action.cancel+'</a></div></div></div></div><div class="aui-blanket"></div></div>'))},f.addStyle=function(a){if(!$("#gm-style")[0]&&a){var b=$('<style id="gm-style" type="text/css"></style>');$(document.head).append(b.html(a))}},f.cacheTicketHandler=function(){f.update();var a=$("#gm-popup .gm-table:last"),c="";c=a[0].outerHTML,b.cacheTicket(c.trimWhitespace()),f._hidePopup(),f._showSuccessMessage()},f._showSuccessMessage=function(){$(".aui-message").remove(),AJS.messages.success(".aui-page-header-inner",{title:c.messages.ticketCached.title,body:c.messages.ticketCached.body}),setTimeout(function(){$(".aui-message").remove()},5e3)},f.showPopup=function(){$("#gm-popup")[0]||(b.subscribe(this),f._updateHTML(b.getCachedTickets()),$("body").on("click",".gm-print",function(a){a.preventDefault(),window.print(),b.removeCachedTickets(),f._hidePopup()}).on("click",".gm-pick-more",function(a){a.preventDefault(),f.cacheTicketHandler()}).on("click",".gm-cancel",function(a){a.preventDefault(),f._hidePopup()}).on("click",".js-gm-remove-ticket",function(a){a.preventDefault();var c=$(a.target).parents("li"),d=c.index(c);b.removeCachedTickets(d),$("#gm-popup .form-body table").eq(d).remove(),f._updateHTML(b.getCachedTickets())}).on("click","#gm-add-collaborator",function(){b.addCollaborators(c.modal.collaboratorPrompt)}))},f.update=function(){f._updateHTML(b.getCachedTickets())},f.collectDataFromDom=function(a){var b=$("#greenhopper-agile-issue-web-panel dd a"),c=new xing.jira.Presenter,d=c.getString($("#type-val img").attr("alt")),e=a.COLLABORATOR_KEY,f=c.getString($("#summary-val").text());a.update({number:c.getString($("#key-val").text()),description:c.getString($("#description-val").text()),dueDate:c.getDate($("#due-date time").attr("datetime")),collaborators:c.getStorageItem(e).join(" "),type:d,typeSelector:c.dashalizer(d),reporter:c.getString($("#reporter-val span").text()),created:c.getDate($("#create-date time").attr("datetime")),title:f.truncate(220),component:c.getString($("#components-field").text()),target:c.getElementText(b)})},f.initialze(a)};var xing=xing||{};xing.jira=xing.jira||{},xing.jira.DataCollector=function(){"use strict";var a=this,b=location.hostname,c=b?".":"";a.COLLABORATOR_KEY=b+c+"collaborators",a.TICKET_KEY=b+c+"ticket",a.observers=[],a.ticketData={},a.getCachedTickets=function(){var b=localStorage.getItem(a.TICKET_KEY);return b&&b[0]?JSON.parse(b):[]},a.subscribe=function(b){a.observers.push(b)},a.unsubscribe=function(b){var c=a.observer.indexOf(b);c>=0&&a.observers.splice(c)},a.update=function(b){a.ticketData=$.extend(a.ticketData,b||{}),a.observers.forEach(function(a){a.update()})},a.cacheTicket=function(b){var c=a.getCachedTickets(),d=c.concat([b]);localStorage.setItem(a.TICKET_KEY,JSON.stringify(d))},a.removeCachedTickets=function(b){if(void 0!==b){var c=a.getCachedTickets();c[0]&&(c.splice(b,1),localStorage.setItem(a.TICKET_KEY,JSON.stringify(c)))}else localStorage.removeItem(a.TICKET_KEY);return a.getCachedTickets()},a.addCollaborators=function(b){var c=localStorage.getItem(a.COLLABORATOR_KEY)||"",d=window.prompt(b,c||"");null!==d&&(localStorage.setItem(a.COLLABORATOR_KEY,d),this.update({collaborators:d.toArray()}))}},String.prototype.truncate=function(a){"use strict";var b=this.length,c="â€¦",d=c.length,e=this;return b>a&&(e=this.substr(0,a-d)+c),e},String.prototype.trimWhitespace=function(){"use strict";return this.replace(/\s+/g," ").split(/\n/).join(" ")},String.prototype.toArray=function(a){"use strict";return a=new RegExp(a||","),this.split(a)};var xing=xing||{};xing.jira=xing.jira||{},xing.jira.I18n=function(){"use strict";this.en={messages:{ticketCached:{title:"Ticket print",body:"Ticket is stored! Please navigate to another if you want print one ticket more."}},modal:{collaboratorPrompt:'Please enter your collaborators!\nNote: Separate the names with a comma e.g. "Jeffrey, Walter"',heading:"Print preview",select:"Select another:",action:{addCollaborator:"Add Collaborators",remove:"Remove ticket form the list",print:"Print",cancel:"Cancel"},ticketCount:"You are printing tickets",pageCount:" on pages"},ticket:{collaborator:{title:"Pairing",action:'<button id="gm-add-collaborator" class="aui-button gm-snap-right"><i>+</i> Add Collaborators</button>'},component:{title:"Component"},closed:{title:"End date",body:"Day | Time"},created:{title:"Created"},dueDate:{title:"Due date"},reporter:{title:"Reporter"},target:{title:"Target"},type:{title:"Type"},start:{title:"Start Progress",body:"Day | Time"}}},this.local=function(a){return this[a||"en"]}};var xing=xing||{};xing.jira=xing.jira||{},xing.jira.Presenter=function(){"use strict";var a=this;a.dashalizer=function(a){return a.toLowerCase().replace(/ /g,"-")},a.getString=function(a){return a||""},a.getDate=function(a){var b,c,d,e,f="";return a&&(b=new Date(a),c=b.getMonth()+1,c=c>9?c:"0"+c,d=b.getFullYear(),e=b.getDate(),f=d+"-"+c+"-"+e),f},a.getStorageItem=function(a){var b=localStorage.getItem(a)||"";return b.toArray()},a.getElementText=function(a){return a[0]?a.text().trimWhitespace():""}};var xing=xing||{};xing.jira=xing.jira||{},xing.jira.TableBuilder=function(){"use strict";var a=this;a._text=function(a){return"text"in a?a.text:""},a._addOptions=function(a,b){b=" "+(b||"");var c,d=a.options||{},e="cssClass"in d?d.cssClass:"",f="";$.extend(d,{cssClass:e+b})," "===d.cssClass&&delete d.cssClass;for(c in d){var g="cssClass"===c?"class":c,h=d[c]||"";g=g.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),f+=" "+g+'="'+h+'"'}return f},a.row=function(b){var c="";return b.forEach(function(b){c+=a.cell(b)}),"<tr"+a._addOptions(b)+">"+c+"</tr>"},a.cell=function(b){var c=b.cell,d="",e=b.head?"th":"td";return d+=a.cellTitle(c),d+=a.cellBody(c),"<"+e+a._addOptions(c)+'><div class="gm-inner">'+d+"</div></"+e+">"},a.cellBody=function(b){var c="";if("body"in b){var d=b.body;c+="<div"+a._addOptions(d,"gm-bd")+">"+a._text(d)+"</div>"}return c},a.cellTitle=function(b){var c="";if("title"in b){var d=b.title;c+="<div"+a._addOptions(d,"gm-hd")+">"+a._text(d)+"</div>"}return c},a.render=function(b){var c="";return b.forEach(function(b){c+=a.row(b)}),'<table class="gm-table">'+c+"</table>"}};var xing=xing||{};xing.jira=xing.jira||{},xing.jira.TableData=function(){"use strict";var a=5,b=(new xing.jira.I18n).local().ticket;this.get=function(c){return[[{head:!0,cell:{options:{colspan:2,cssClass:"gm-number gm-ltr"},body:{text:c.number,options:{cssClass:"h1",title:c.number}}}},{cell:{title:{text:b.type.title},body:{options:{cssClass:"gm-label gm-label-"+c.typeSelector},text:c.type}}},{cell:{title:{text:b.component.title},body:{text:c.component}}},{cell:{title:{text:b.target.title},body:{text:c.target}}}],[{head:!0,cell:{options:{colspan:a,cssClass:"gm-title gm-ltr"},body:{text:c.title,options:{cssClass:"h2 gm-hyphen"}}}}],[{cell:{options:{colspan:a,cssClass:"gm-pairing"},title:{text:b.collaborator.title,options:{cssClass:"gm-snap-left h5"}},body:{text:c.collaborators+b.collaborator.action,options:{cssClass:"h5"}}}}],[{cell:{title:{text:b.created.title},body:{text:c.created}}},{cell:{title:{text:b.dueDate.title},body:{options:{cssClass:c.dueDate?"gm-label-danger gm-label":""},text:c.dueDate}}},{cell:{title:{text:b.reporter.title},body:{text:c.reporter}}},{cell:{options:{cssClass:"gm-date-content gm-20"},title:{text:b.start.title},body:{text:b.start.body}}},{cell:{options:{cssClass:"gm-date-content gm-20"},title:{text:b.closed.title},body:{text:b.closed.body}}}]]}};var xingJiraApp = new xing.jira.Application();xingJiraApp.versionTimestamp="2013-10-28 4:51:10 PM";xingJiraApp.version="2.0.0";xingJiraApp.cacheTicketHandler();})();